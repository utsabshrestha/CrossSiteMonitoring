@inject UserManager<ApplicationUser> userManager;

@model IEnumerable<DetailRoadList>

@{
    ViewBag.Title = "Construction Site Monitoring Dashboard";
    var i = 1;
    var user = await userManager.GetUserAsync(User);
}

@if (Model.Any())
{

    <div class="row">
        <form asp-action="ListRoads" method="post">
            <input asp-for="@Model.First().district" name="districtSelected" type="hidden" />
            <button type="submit" class="btn btn-lg" style="font-weight:600; color: #0366d6">Go to @Model.First().district District</button>
        </form>
    </div>

    <div class="mb-5"></div>

    <table id="example" class="table table-hover" style="width:100%">
        <thead>
            <tr>
                <th scope="col">SN</th>
                <th scope="col">Observer Name</th>
                <th scope="col">Designation</th>
                <th scope="col">Visit Date</th>
                <th scope="col">Uploaded Date</th>
                <th scope="col">Report status</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var road in Model)
            {
                <tr>
                    <th scope="row">@i</th>
                    <td>@road.observer_name</td>
                    <td>@road.designation</td>
                    <td>@road.date.Year-@road.date.Month-@road.date.Day</td>
                    <td>@road.uploaded_date.Year-@road.uploaded_date.Month-@road.uploaded_date.Day</td>
                    <td>
                        @if (road.report_status == 1)
                        {
                            <a href="#" class="btn btn-sm styleMy">Final Report</a>
                        }
                        else
                        {
                            <a href="#" class="btn btn-sm  styleMy" style="color: darkturquoise !important">Pending!</a>
                        }
                    </td>
                    <td>

                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-primary" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Actions!
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <h6 class="dropdown-header">Manage Reports</h6>

                                @if ((User.IsInRole("Admin") || user.Email == road.observer_email) && road.report_status == 0)
                                {
                                    <a class="dropdown-item" href="#" type="button">Finalize</a>
                                }

                                @if (user.Email == road.observer_email || User.IsInRole("Admin") || road.report_status == 1)
                                {
                                    <form asp-action="ViewReport" method="post" class="dropdown-item">
                                        <input value="@road.road_code" name="road_code" type="hidden" />
                                        <input value="@road.date" name="date" type="hidden" />
                                        <input value="@road.observer_email" name="observer_email" type="hidden" />
                                        <input value="@road.road_name" name="road_name" type="hidden" />
                                        <button class="btn dropdown-item" type="submit" style="padding: 0px;" formtarget="_blank">View Report</button>
                                    </form>
                                }
                                else
                                {
                                    <a class="dropdown-item" href="#" type="button">Not Finalize</a>
                                }

                                @if (user.Email == road.observer_email || User.IsInRole("Admin"))
                                {
                                    if (road.report_status == 0)
                                    {
                                        <a class="dropdown-item" href="#" type="button">Edit Report</a>
                                    }

                                    if (User.IsInRole("Admin"))
                                    {
                                        <a class="dropdown-item" href="#" type="button">Delete Report</a>
                                    }


                                }
                            </div>
                        </div>
                    </td>
                </tr>
                i++;
            }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-success" role="alert">
        <h4 class="alert-heading">Opps!</h4>
        <hr>
        <p class="mb-0">Empty Report! </p>
    </div>
}

@section Scripts{
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/js/DataTableBootstrp.js"></script>
}
